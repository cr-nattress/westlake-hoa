# Story 10.8: Enhanced Escalation Flow

## User Story

**As a** homeowner with an unresolved issue
**I want** a clear visual escalation path showing authority at each level
**So that** I know exactly who can resolve my issue and when to escalate

## Description

Enhance the existing enforcement timeline component to show a complete escalation flow that integrates authority boundaries. When Bold cannot act (authority limitation), the flow clearly shows that Board authorization is required before proceeding.

## Acceptance Criteria

- [ ] Visual flow diagram showing escalation path
- [ ] Each step shows: entity, their authority, and limitations
- [ ] Clear indication of when Board action is required
- [ ] Authority boundaries integrated from Stories 10.2/10.3
- [ ] Interactive (expandable steps with details)
- [ ] Links to relevant pages (contacts, governance)
- [ ] Mobile-responsive design
- [ ] Accessible

## Technical Details

### Component

```
src/components/enhanced-escalation-flow.tsx
// Updates/extends: src/components/enforcement-timeline.tsx
```

### Data Structure

```typescript
interface EscalationStep {
  step: number;
  entity: string;
  action: string;
  description: string;
  authority: string[];         // What they CAN do
  limitations?: string[];       // What they CANNOT do
  escalateTriggers?: string[]; // When to escalate to next step
  contactLink?: string;        // Link to contact info
}

const ESCALATION_FLOW: EscalationStep[] = [
  {
    step: 1,
    entity: "Bold Property Management",
    action: "Initial Contact",
    description: "Submit issue or request to property management",
    authority: [
      "Receive and respond to communications",
      "Coordinate maintenance and vendors",
      "Issue warnings and notices"
    ],
    limitations: [
      "Cannot initiate legal action",
      "Cannot waive fees without Board approval"
    ],
    escalateTriggers: [
      "No response within 7-10 business days",
      "Issue requires Board authority",
      "Dispute over fees or fines"
    ],
    contactLink: "/contacts"
  },
  {
    step: 2,
    entity: "Board of Directors",
    action: "Board Review",
    description: "Request Board review for matters beyond management authority",
    authority: [
      "Approve/deny fee waivers",
      "Authorize legal action",
      "Make policy decisions",
      "Direct management actions"
    ],
    limitations: [
      "May require meeting to act",
      "Cannot address attorney-client matters"
    ],
    escalateTriggers: [
      "Board fails to respond or act",
      "Matter becomes legal dispute",
      "CCIOA rights violated"
    ],
    contactLink: "/governance"
  },
  {
    step: 3,
    entity: "HOA Legal Counsel",
    action: "Legal Escalation",
    description: "Matters referred to Alpenglow Law, LLC",
    authority: [
      "Handle collections",
      "Formal legal correspondence",
      "Compliance enforcement"
    ],
    limitations: [
      "Acts on Board authorization only",
      "May limit owner direct communication"
    ],
    escalateTriggers: [
      "Legal rights violated",
      "Need independent legal advice"
    ],
    contactLink: "/contacts"
  },
  {
    step: 4,
    entity: "Independent Counsel / Regulatory",
    action: "External Resolution",
    description: "Consult your own attorney or file regulatory complaints",
    authority: [
      "Independent legal advice",
      "CCIOA violation complaints",
      "Civil litigation if needed"
    ],
    limitations: [],
    escalateTriggers: []
  }
];
```

### Visual Design

```
┌─────────────────────────────────────────────────────────────┐
│ Escalation Path                                              │
│ Understanding who can help at each level                     │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ 1  BOLD PROPERTY MANAGEMENT                         │    │
│  │    Initial Contact                                  │    │
│  │    ─────────────────────────────────────────────    │    │
│  │    ✓ Can: Respond to communications, coordinate     │    │
│  │       maintenance, issue warnings                   │    │
│  │    ✗ Cannot: Initiate legal action, waive fees     │    │
│  │    ─────────────────────────────────────────────    │    │
│  │    Escalate when: No response in 7-10 days,         │    │
│  │    requires Board authority                         │    │
│  └─────────────────────────────────────────────────────┘    │
│                         │                                    │
│                         ▼                                    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ 2  BOARD OF DIRECTORS                               │    │
│  │    Board Review                                     │    │
│  │    ─────────────────────────────────────────────    │    │
│  │    ✓ Can: Approve waivers, authorize legal action,  │    │
│  │       make policy decisions                         │    │
│  │    ✗ Cannot: May require meeting to act             │    │
│  │    ─────────────────────────────────────────────    │    │
│  │    Escalate when: Board fails to act, matter        │    │
│  │    becomes legal dispute                            │    │
│  └─────────────────────────────────────────────────────┘    │
│                         │                                    │
│                         ▼                                    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ 3  HOA LEGAL COUNSEL (Alpenglow Law)                │    │
│  │    Legal Escalation                                 │    │
│  │    ─────────────────────────────────────────────    │    │
│  │    ✓ Can: Handle collections, formal correspondence │    │
│  │    ✗ Cannot: Acts on Board authorization only       │    │
│  └─────────────────────────────────────────────────────┘    │
│                         │                                    │
│                         ▼                                    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ 4  INDEPENDENT COUNSEL / REGULATORY                 │    │
│  │    External Resolution                              │    │
│  │    ─────────────────────────────────────────────    │    │
│  │    Consult your own attorney or file complaints     │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### Component Structure

```tsx
export function EnhancedEscalationFlow({ steps, className }: Props) {
  const [expandedStep, setExpandedStep] = useState<number | null>(null);

  return (
    <div className={cn("space-y-4", className)}>
      <h2 className="text-xl font-semibold">Escalation Path</h2>
      <p className="text-muted-foreground">
        Understanding who can help at each level
      </p>

      <div className="relative">
        {/* Vertical line connecting steps */}
        <div className="absolute left-6 top-0 bottom-0 w-0.5 bg-border" />

        {steps.map((step, index) => (
          <div key={step.step} className="relative pl-14 pb-8">
            {/* Step number circle */}
            <div className="absolute left-0 w-12 h-12 rounded-full bg-primary flex items-center justify-center text-primary-foreground font-bold">
              {step.step}
            </div>

            <Card className="cursor-pointer" onClick={() => toggleStep(step.step)}>
              <CardHeader className="pb-2">
                <CardTitle className="text-lg">{step.entity}</CardTitle>
                <CardDescription>{step.action}</CardDescription>
              </CardHeader>

              <Collapsible open={expandedStep === step.step}>
                <CollapsibleContent>
                  <CardContent className="space-y-4">
                    {/* Authority list */}
                    {step.authority.length > 0 && (
                      <div>
                        <h4 className="font-medium text-green-700 mb-1">Can:</h4>
                        <ul className="space-y-1">
                          {step.authority.map((a, i) => (
                            <li key={i} className="flex items-start gap-2 text-sm">
                              <Check className="h-4 w-4 text-green-600 mt-0.5" />
                              {a}
                            </li>
                          ))}
                        </ul>
                      </div>
                    )}

                    {/* Limitations list */}
                    {step.limitations && step.limitations.length > 0 && (
                      <div>
                        <h4 className="font-medium text-amber-700 mb-1">Cannot:</h4>
                        <ul className="space-y-1">
                          {step.limitations.map((l, i) => (
                            <li key={i} className="flex items-start gap-2 text-sm">
                              <X className="h-4 w-4 text-amber-600 mt-0.5" />
                              {l}
                            </li>
                          ))}
                        </ul>
                      </div>
                    )}

                    {/* Escalation triggers */}
                    {step.escalateTriggers && step.escalateTriggers.length > 0 && (
                      <div className="pt-2 border-t">
                        <h4 className="font-medium mb-1">Escalate when:</h4>
                        <ul className="space-y-1">
                          {step.escalateTriggers.map((t, i) => (
                            <li key={i} className="text-sm text-muted-foreground">
                              • {t}
                            </li>
                          ))}
                        </ul>
                      </div>
                    )}
                  </CardContent>
                </CollapsibleContent>
              </Collapsible>
            </Card>
          </div>
        ))}
      </div>
    </div>
  );
}
```

## Story Points: 3

## Priority: Medium

## Dependencies

- Story 10.2 (Delegated Authority) - for authority data
- Story 10.3 (Authority Limitations) - for limitations data
- Existing enforcement-timeline.tsx component

## Definition of Done

- [ ] Component created/enhanced
- [ ] All 4 escalation steps displayed
- [ ] Authority and limitations shown for each step
- [ ] Escalation triggers listed
- [ ] Steps are expandable/collapsible
- [ ] Visual flow with connecting lines
- [ ] Step numbers prominent
- [ ] Mobile-responsive layout
- [ ] Dark mode styling works
- [ ] Screen reader accessible
- [ ] Contact links work
