# Story 8.4: Topic Index Data Structure

## User Story

**As a** developer building quick answers and FAQ
**I want** a structured index mapping common topics to documents
**So that** we can provide instant answers without AI processing

## Description

Create a topic index that maps common resident questions/topics to specific documents and sections. This enables Quick Answer cards, FAQ generation, and smarter AI context selection.

## Acceptance Criteria

- [ ] Topic index covers 25+ common topics
- [ ] Each topic has: slug, name, category, quickAnswer, primaryDocument, sections, relatedDocuments, keywords
- [ ] Topics organized into 4 categories: financial, insurance, rules, governance
- [ ] Keywords enable search matching
- [ ] Function to find topics by keyword
- [ ] Function to get topics by category
- [ ] TypeScript types exported

## Technical Details

### File Location
`src/lib/data/topic-index.ts`

### Type Definitions

```typescript
export type TopicCategory = 'financial' | 'insurance' | 'rules' | 'governance';

export interface TopicEntry {
  slug: string;
  name: string;
  category: TopicCategory;
  question: string;           // Common question phrasing
  quickAnswer: string;        // 1-2 sentence answer
  primaryDocument: string;    // Document slug
  sections: string[];         // Relevant section names
  relatedDocuments: string[]; // Additional document slugs
  keywords: string[];         // Search matching keywords
}

export const TOPIC_INDEX: TopicEntry[] = [
  // ... topics
];
```

### Topic Categories

**Financial (8+ topics)**
- assessments, late-fees, payment-plans, interest, foreclosure, liens, special-assessments, budget

**Insurance (6+ topics)**
- hoa-coverage, owner-coverage, claims, deductibles, liability, certificates

**Rules (8+ topics)**
- pets, parking, noise, renovations, trash, balconies, smoking, quiet-hours, heating

**Governance (5+ topics)**
- voting, meetings, board, records, violations, appeals

### Sample Topics

```typescript
export const TOPIC_INDEX: TopicEntry[] = [
  // Financial
  {
    slug: 'assessments',
    name: 'Monthly Assessments',
    category: 'financial',
    question: 'When are HOA assessments due?',
    quickAnswer: 'Monthly assessments are due on the 1st of each month. Accounts become past due after 1 day and delinquent after 15 days.',
    primaryDocument: 'collections-policy-2025',
    sections: ['Assessment Due Dates'],
    relatedDocuments: ['responsible-governance-policies-2025'],
    keywords: ['assessment', 'dues', 'payment', 'monthly', 'fee', 'due date']
  },
  {
    slug: 'late-fees',
    name: 'Late Fees',
    category: 'financial',
    question: 'What are the late fees for missed payments?',
    quickAnswer: 'Late fees escalate: $50 (1 month past due), $150 (2 months), $250 (3+ months). Interest of 8% annually begins 15 days after due date.',
    primaryDocument: 'collections-policy-2025',
    sections: ['Late Fee Schedule', 'Interest'],
    relatedDocuments: ['responsible-governance-policies-2025'],
    keywords: ['late', 'fee', 'penalty', 'overdue', 'delinquent', 'interest']
  },
  {
    slug: 'payment-plans',
    name: 'Payment Plans',
    category: 'financial',
    question: 'Can I set up a payment plan?',
    quickAnswer: 'Yes, the HOA must offer payment plans with a minimum term of 18 months before proceeding with collections. Contact the property manager to arrange.',
    primaryDocument: 'collections-policy-2025',
    sections: ['Repayment Plans'],
    relatedDocuments: ['responsible-governance-policies-2025'],
    keywords: ['payment', 'plan', 'arrangement', 'installment', 'hardship']
  },

  // Insurance
  {
    slug: 'hoa-coverage',
    name: 'HOA Insurance Coverage',
    category: 'insurance',
    question: 'What does the HOA insurance cover?',
    quickAnswer: 'The HOA master policy covers building exteriors, common areas, and original fixtures. Coverage: $22.4M property, $1M liability, $10M umbrella. Deductible: $15,000.',
    primaryDocument: 'insurance-certificate-2025-2026',
    sections: ['Coverage Summary'],
    relatedDocuments: ['unit-owners-letter-2025-2026'],
    keywords: ['insurance', 'coverage', 'master', 'policy', 'hoa', 'association']
  },
  {
    slug: 'owner-coverage',
    name: 'Owner Insurance Responsibilities',
    category: 'insurance',
    question: 'What do I need to insure as a unit owner?',
    quickAnswer: 'Owners must insure: interior improvements/upgrades, personal contents, loss of use/rental income, and personal liability inside the unit. The HOA policy does not cover these.',
    primaryDocument: 'unit-owners-letter-2025-2026',
    sections: ['Owner Responsibilities'],
    relatedDocuments: ['insurance-certificate-2025-2026'],
    keywords: ['owner', 'insurance', 'condo', 'ho6', 'contents', 'personal', 'liability']
  },
  {
    slug: 'claims',
    name: 'Filing Insurance Claims',
    category: 'insurance',
    question: 'How do I file an insurance claim?',
    quickAnswer: 'Contact Mountain West Insurance: claims@mtnwst.com or 970-945-9111. For emergencies, call immediately. Have your unit number and incident details ready.',
    primaryDocument: 'insurance-ready-reference-2025-2026',
    sections: ['Claims Contact'],
    relatedDocuments: ['insurance-certificate-2025-2026'],
    keywords: ['claim', 'file', 'report', 'damage', 'incident', 'emergency']
  },

  // Rules
  {
    slug: 'pets',
    name: 'Pet Policy',
    category: 'rules',
    question: 'Can I have a pet?',
    quickAnswer: 'Yes, one dog or cat per unit is allowed. Pets must be leashed (10 ft max) in common areas. Tenants pay $100/month pet fee. Breeds may be restricted.',
    primaryDocument: 'rules-and-regulations-2018',
    sections: ['Pet Policy'],
    relatedDocuments: [],
    keywords: ['pet', 'dog', 'cat', 'animal', 'leash', 'breed']
  },
  {
    slug: 'parking',
    name: 'Parking Rules',
    category: 'rules',
    question: 'What are the parking rules?',
    quickAnswer: 'Each unit has 2 assigned parking spaces. Vehicles must be legal, registered, and insured. No commercial vehicles, RVs, or boats. Vehicles must move every 7 days.',
    primaryDocument: 'rules-and-regulations-2018',
    sections: ['Parking Regulations'],
    relatedDocuments: [],
    keywords: ['parking', 'car', 'vehicle', 'space', 'garage', 'rv', 'commercial']
  },
  {
    slug: 'quiet-hours',
    name: 'Quiet Hours',
    category: 'rules',
    question: 'What are the quiet hours?',
    quickAnswer: 'Quiet hours are 10 PM to 8 AM. No excessive noise, loud music, or instruments during these hours. Construction/renovations only during daytime hours.',
    primaryDocument: 'rules-and-regulations-2018',
    sections: ['Noise'],
    relatedDocuments: [],
    keywords: ['quiet', 'noise', 'hours', 'loud', 'music', 'sound']
  },
  {
    slug: 'renovations',
    name: 'Renovation Approval',
    category: 'rules',
    question: 'Do I need approval for renovations?',
    quickAnswer: 'Yes, written Board approval is required for plumbing, electrical, HVAC, and structural changes. Submit plans before starting work. Some work has seasonal restrictions.',
    primaryDocument: 'rules-and-regulations-2018',
    sections: ['Architectural Approval', 'Renovations'],
    relatedDocuments: ['declaration-of-condominium'],
    keywords: ['renovation', 'remodel', 'approval', 'construction', 'architectural', 'permit']
  },

  // Governance
  {
    slug: 'voting',
    name: 'Voting Rights',
    category: 'governance',
    question: 'How do I vote in HOA elections?',
    quickAnswer: 'Each unit has 1 vote. Voting occurs at annual meetings (typically November) or by mail ballot. Proxy voting is allowed. Must be current on assessments to vote.',
    primaryDocument: 'bylaws',
    sections: ['Membership and Voting', 'Voting Procedures'],
    relatedDocuments: ['declaration-of-condominium'],
    keywords: ['vote', 'voting', 'election', 'ballot', 'proxy', 'member']
  },
  {
    slug: 'records',
    name: 'Records Inspection',
    category: 'governance',
    question: 'How do I request HOA records?',
    quickAnswer: 'Submit a written request describing the records needed. The HOA must respond within 10 business days. Most records are available; some (attorney communications, personnel files) are restricted.',
    primaryDocument: 'records-inspection-policy-2025',
    sections: ['Owner Rights', 'Request Procedures'],
    relatedDocuments: ['responsible-governance-policies-2025'],
    keywords: ['records', 'documents', 'inspection', 'request', 'access', 'ccioa']
  },
  {
    slug: 'violations',
    name: 'Rule Violations',
    category: 'governance',
    question: 'What happens if I violate a rule?',
    quickAnswer: 'Process: Warning → $100 fine → $200 fine → $300+ fines. You have 5 days to request a hearing. Non-safety violations capped at $500. Health/safety violations have unlimited fines.',
    primaryDocument: 'enforcement-policy-2025',
    sections: ['Fine Schedule', 'Hearing Rights'],
    relatedDocuments: ['responsible-governance-policies-2025', 'rules-and-regulations-2018'],
    keywords: ['violation', 'fine', 'penalty', 'enforcement', 'hearing', 'appeal']
  },
];
```

### Utility Functions

```typescript
export function findTopicsByKeyword(query: string): TopicEntry[] {
  const queryLower = query.toLowerCase();
  return TOPIC_INDEX.filter(topic =>
    topic.keywords.some(kw => queryLower.includes(kw)) ||
    topic.name.toLowerCase().includes(queryLower) ||
    topic.question.toLowerCase().includes(queryLower)
  );
}

export function getTopicsByCategory(category: TopicCategory): TopicEntry[] {
  return TOPIC_INDEX.filter(topic => topic.category === category);
}

export function getTopicBySlug(slug: string): TopicEntry | undefined {
  return TOPIC_INDEX.find(topic => topic.slug === slug);
}

export function getAllCategories(): TopicCategory[] {
  return ['financial', 'insurance', 'rules', 'governance'];
}
```

## Story Points: 3

## Priority: High

## Dependencies
- Story 8.2 (Populate Document Content) - need document slugs to reference

## Definition of Done
- [ ] TopicEntry type defined and exported
- [ ] 25+ topics covering all 4 categories
- [ ] All topics have complete data (no empty fields)
- [ ] Keywords are comprehensive for search matching
- [ ] Utility functions implemented and tested
- [ ] Document slugs match actual documents
