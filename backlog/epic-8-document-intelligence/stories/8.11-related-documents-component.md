# Story 8.11: Related Documents Component

## User Story

**As a** resident reading a document
**I want** to see related documents
**So that** I can find additional relevant information

## Description

Create a Related Documents component that shows documents related to the current one, based on the topic index and document type. Display on document detail pages.

## Acceptance Criteria

- [ ] Shows up to 4 related documents
- [ ] Relationship based on shared topics
- [ ] Falls back to same document type if no topic match
- [ ] Shows document title, type badge, and brief description
- [ ] Links to related document pages
- [ ] Does not show the current document
- [ ] Handles documents with no relations gracefully

## Technical Details

### File Location
`src/components/related-documents.tsx`

### Implementation

```tsx
'use client';

import Link from 'next/link';
import { FileText, ArrowRight } from 'lucide-react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { getAllDocuments, type Document } from '@/lib/data/documents';
import { TOPIC_INDEX } from '@/lib/data/topic-index';

interface RelatedDocumentsProps {
  currentSlug: string;
  currentType: string;
  maxItems?: number;
}

export function RelatedDocuments({
  currentSlug,
  currentType,
  maxItems = 4,
}: RelatedDocumentsProps) {
  const relatedDocs = findRelatedDocuments(currentSlug, currentType, maxItems);

  if (relatedDocs.length === 0) {
    return null;
  }

  return (
    <Card>
      <CardHeader className="pb-3">
        <CardTitle className="text-lg flex items-center gap-2">
          <FileText className="h-5 w-5" />
          Related Documents
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-3">
        {relatedDocs.map((doc) => (
          <Link
            key={doc.id}
            href={`/documents/${doc.slug}`}
            className="flex items-start gap-3 p-3 rounded-lg hover:bg-muted transition-colors group"
          >
            <div className="flex-1 min-w-0">
              <div className="flex items-center gap-2 mb-1">
                <Badge variant="outline" className="text-xs">
                  {doc.type}
                </Badge>
                {doc.status === 'superseded' && (
                  <Badge variant="secondary" className="text-xs">
                    Superseded
                  </Badge>
                )}
              </div>
              <p className="font-medium text-sm group-hover:text-primary transition-colors line-clamp-1">
                {doc.title}
              </p>
              {doc.summary && (
                <p className="text-xs text-muted-foreground line-clamp-2 mt-1">
                  {doc.summary}
                </p>
              )}
            </div>
            <ArrowRight className="h-4 w-4 text-muted-foreground group-hover:text-primary transition-colors mt-1" />
          </Link>
        ))}
      </CardContent>
    </Card>
  );
}

function findRelatedDocuments(
  currentSlug: string,
  currentType: string,
  maxItems: number
): Document[] {
  const allDocs = getAllDocuments();

  // Find topics that reference the current document
  const relatedTopics = TOPIC_INDEX.filter(
    (t) =>
      t.primaryDocument === currentSlug ||
      t.relatedDocuments.includes(currentSlug)
  );

  // Get documents from those topics
  const relatedSlugs = new Set<string>();
  for (const topic of relatedTopics) {
    relatedSlugs.add(topic.primaryDocument);
    topic.relatedDocuments.forEach((slug) => relatedSlugs.add(slug));
  }

  // Remove current document
  relatedSlugs.delete(currentSlug);

  // Get document objects
  let related = allDocs.filter((d) => relatedSlugs.has(d.slug));

  // If not enough from topics, add same-type documents
  if (related.length < maxItems) {
    const sameType = allDocs.filter(
      (d) =>
        d.type === currentType &&
        d.slug !== currentSlug &&
        !relatedSlugs.has(d.slug)
    );
    related = [...related, ...sameType];
  }

  // Prioritize current documents
  related.sort((a, b) => {
    if (a.status === 'current' && b.status !== 'current') return -1;
    if (a.status !== 'current' && b.status === 'current') return 1;
    return 0;
  });

  return related.slice(0, maxItems);
}
```

### Usage in Document Page

```tsx
// src/app/documents/[slug]/page.tsx

import { RelatedDocuments } from '@/components/related-documents';

// In the page component
<div className="lg:col-span-1 space-y-6">
  {/* AI Chat */}
  <DocumentChat document={document} />

  {/* Related Documents */}
  <RelatedDocuments
    currentSlug={document.slug}
    currentType={document.type}
    maxItems={4}
  />
</div>
```

## Visual Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“„ Related Documents                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [policy]                      â†’ â”‚ â”‚
â”‚ â”‚ Collections Policy              â”‚ â”‚
â”‚ â”‚ Procedures for assessment...    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [rule]                        â†’ â”‚ â”‚
â”‚ â”‚ Rules and Regulations           â”‚ â”‚
â”‚ â”‚ Community rules covering...     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [insurance]                   â†’ â”‚ â”‚
â”‚ â”‚ Insurance Certificate 2025-26   â”‚ â”‚
â”‚ â”‚ Annual certificate showing...   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Story Points: 3

## Priority: Medium

## Dependencies
- Story 8.4 (Topic Index)

## Definition of Done
- [ ] Component displays related documents
- [ ] Topic-based relationships work
- [ ] Same-type fallback works
- [ ] Current document excluded
- [ ] Links navigate correctly
- [ ] Responsive design
- [ ] Empty state handled
- [ ] Integrated into document page
